<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <!--  This file has been downloaded from bootdey.com @bootdey on twitter -->
    <!--  All snippets are MIT license http://bootdey.com/license -->
    <title>bs4 Kanban Board - Bootdey.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container-fluid pt-3">
    <h3 class="font-weight-light text-white">Kanban Board</h3>
    <div class="small  text-light">Drag and drop between swim lanes</div>
    <a th:href = "@{/showNewCardForm}" class="btn btn-primary btn-lg" style="margin:20px">New Card</a>

       <div class="row flex-row flex-sm-nowrap py-3">
        <div class="col-sm-6 col-md-4 col-xl-3">
            <div class="card bg-light">
                <div class="card-body">
                    <h6 class="card-title text-uppercase text-truncate py-2"  >To Do</h6>
                    <div class="items border border-light" th:each="card : ${cardList.?[cardStatus == 0 ]}">
                        <div class="card draggable shadow-sm" id=""  th:id="'CD' + ${card.cardId}" draggable="true" ondragstart="drag(event)"  >
                            <div class="card-body p-2">
                                <div class="card-title">
                                    <img src="//via.placeholder.com/30" class="rounded-circle float-right">
                                    <a href="" class="lead font-weight-light" th:text="${card.cardTitle}" ></a>
                                </div>
                                <p  th:text="${card.cardText}">

                                </p>
                                <a  th:href="@{'/editCard/' + ${card.cardId}}" class="btn btn-primary btn-sm">Edit</a>
                            </div>
                        </div>
                        <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-xl-3">
            <div class="card bg-light">
                <div class="card-body">
                    <h6 class="card-title text-uppercase text-truncate py-2">In-progess</h6>
                    <div class="items border border-light">
                        <div class="items border border-light" th:each="card : ${cardList.?[cardStatus == 1]}">
                            <div class="card draggable shadow-sm" id=""  th:id="'CD' + ${card.cardId}" draggable="true" ondragstart="drag(event)"  >
                                <div class="card-body p-2">
                                    <div class="card-title">
                                        <img src="//via.placeholder.com/30" class="rounded-circle float-right">
                                        <a href="" class="lead font-weight-light" th:text="${card.cardTitle}" ></a>
                                    </div>
                                    <p  th:text="${card.cardText}">

                                    </p>
                                    <a  th:href="@{'/editCard/' + ${card.cardId}}" class="btn btn-primary btn-sm">Edit</a>
                                </div>
                            </div>
                            <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                        </div>
                        <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-xl-3">
            <div class="card bg-light">
                <div class="card-body">
                    <h6 class="card-title text-uppercase text-truncate py-2">Review</h6>
                    <div class="items border border-light">
                        <div class="items border border-light">
                            <div class="items border border-light" th:each="card : ${cardList.?[cardStatus == 3]}">
                                <div class="card draggable shadow-sm" id=""  th:id="'CD' + ${card.cardId}" draggable="true" ondragstart="drag(event)"  >
                                    <div class="card-body p-2">
                                        <div class="card-title">
                                            <img src="//via.placeholder.com/30" class="rounded-circle float-right">
                                            <a href="" class="lead font-weight-light" th:text="${card.cardTitle}" ></a>
                                        </div>
                                        <p  th:text="${card.cardText}">

                                        </p>
                                        <a  th:href="@{'/editCard/' + ${card.cardId}}" class="btn btn-primary btn-sm">Edit</a>
                                    </div>
                                </div>
                                <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                            </div>
                            <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                        </div>
                        <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-xl-3">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title text-uppercase text-truncate py-2">Complete</h6>
                    <div class="items border border-light">
                        <div class="items border border-light">
                            <div class="items border border-light" th:each="card : ${cardList.?[cardStatus == 4]}">
                                <div class="card draggable shadow-sm" id=""  th:id="'CD' + ${card.cardId}" draggable="true" ondragstart="drag(event)"  >
                                    <div class="card-body p-2">
                                        <div class="card-title">
                                            <img src="//via.placeholder.com/30" class="rounded-circle float-right">
                                            <a href="" class="lead font-weight-light" th:text="${card.cardTitle}" ></a>
                                        </div>
                                        <p  th:text="${card.cardText}">

                                        </p>
                                        <a  th:href="@{'/editCard/' + ${card.cardId}}" class="btn btn-primary btn-sm">Edit</a>
                                    </div>
                                </div>
                                <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                            </div>
                            <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>
                        </div>
                        <div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
.card.draggable {
    margin-bottom: 1rem;
    cursor: grab;
}

.droppable {
    background-color: var(--success);
    min-height: 120px;
    margin-bottom: 1rem;
}

</style>

<script type="text/javascript">
const drag = (event) => {
  event.dataTransfer.setData("text/plain", event.target.id);
}

const allowDrop = (ev) => {
  ev.preventDefault();
  if (hasClass(ev.target,"dropzone")) {
    addClass(ev.target,"droppable");
  }
}

const clearDrop = (ev) => {
    removeClass(ev.target,"droppable");
}

const drop = (event) => {
  event.preventDefault();
  const data = event.dataTransfer.getData("text/plain");
  const element = document.querySelector(`#${data}`);
  try {
    // remove the spacer content from dropzone
    event.target.removeChild(event.target.firstChild);
    // add the draggable content
    event.target.appendChild(element);
    // remove the dropzone parent
    unwrap(event.target);
  } catch (error) {
    console.warn("can't move the item to the same place")
  }
  updateDropzones();
}

const updateDropzones = () => {
    /* after dropping, refresh the drop target areas
      so there is a dropzone after each item
      using jQuery here for simplicity */

    var dz = $('<div class="dropzone rounded" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDrop(event)"> &nbsp; </div>');

    // delete old dropzones
    $('.dropzone').remove();

    // insert new dropdzone after each item
    dz.insertAfter('.card.draggable');

    // insert new dropzone in any empty swimlanes
    $(".items:not(:has(.card.draggable))").append(dz);
};

// helpers
function hasClass(target, className) {
    return new RegExp('(\\s|^)' + className + '(\\s|$)').test(target.className);
}

function addClass(ele,cls) {
  if (!hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function unwrap(node) {
    node.replaceWith(...node.childNodes);
}

</script>
</body>
</html>